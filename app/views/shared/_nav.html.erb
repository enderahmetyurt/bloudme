<nav class="bg-blue-600 text-white" data-controller="menu">
  <!-- Email confirmation banner -->
  <% if authenticated? && !Current.user.email_confirmed? %>
    <div class="bg-red-700 px-4 py-3">
      <div class="container mx-auto">
        <p class="text-sm font-semibold">
          ðŸš¨ Please confirm your email until
          <%= (Current.user.confirmation_sent_at + 7.days).strftime("%-d %B %Y") %>.
          After your last day, you cannot use Bloudme ðŸš¨
        </p>
      </div>
    </div>
  <% end %>

  <!-- Main navigation -->
  <div class="container mx-auto px-4 py-4">
    <div class="flex items-center justify-between gap-4">
      <!-- Logo -->
      <div class="flex-shrink-0">
        <%= link_to "Bloudme", root_path, class: "text-2xl font-bold hover:text-blue-300" %>
      </div>

      <!-- Desktop Navigation (hidden on mobile) -->
      <% if authenticated? %>
        <div class="hidden sm:flex items-center gap-6">
          <!-- Search -->
          <div class="flex-1 min-w-0">
            <%= form_with(url: search_articles_path, method: :get, data: { turbo_frame: "articles", controller: "search" }) do |f| %>
              <%= f.text_field :query,
                  placeholder: t("search"),
                  class: "w-full px-4 py-2 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-300",
                  data: { turbo_frame: "articles", search_target: "input" } %>
            <% end %>
          </div>

          <!-- Add Feed Link -->
          <% unless request.path == "/feeds/new" %>
            <div class="flex-shrink-0">
              <%= link_to t("feeds.new"), new_feed_path, class: "rounded-lg py-2 px-3 border-2 border-white text-white hover:bg-blue-700 font-medium whitespace-nowrap" %>
            </div>
          <% end %>

          <!-- Language Selector (if not authenticated, shown in unauthenticated section) -->
          <div class="flex-shrink-0 flex gap-2">
            <% I18n.available_locales.each do |locale| %>
              <%= link_to locale_to_flag(locale), url_for(locale: locale), class: "text-xl #{locale == I18n.locale ? 'opacity-100' : 'opacity-60 hover:opacity-100'}" %>
            <% end %>
          </div>

          <!-- User Dropdown -->
          <div data-controller="dropdown" class="relative flex-shrink-0">
            <%= image_tag Current.user.avatar_url,
                  alt: "User Avatar",
                  class: "w-10 h-10 rounded-full ring-2 ring-gray-300 cursor-pointer hover:ring-white transition",
                  data: { action: "click->dropdown#toggle" } %>

            <div
              class="
                absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg
                hidden z-50
              "
              data-dropdown-target="menu"
            >
              <ul class="py-1">
                <li>
                  <%= link_to t("settings.profile"), user_path(Current.user), class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" %>
                </li>

                <li>
                  <%= link_to t("bookmarks"), bookmarks_path, class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" %>
                </li>

                <li>
                  <%= link_to settings_user_path(Current.user), class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" do %>
                    <%= t("users.settings.title") %>
                  <% end %>
                </li>

                <% if Current.user.is_admin %>
                  <li>
                    <%= link_to "Admin", "/avo", class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" %>
                  </li>
                <% end %>

                <li class="border-t">
                  <%= button_to t("home.sign_out"), session_path, method: :delete, class: "w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded text-sm mt-2" %>
                </li>
              </ul>
            </div>
          </div>
        </div>
      <% end %>

      <!-- Unauthenticated Navigation -->
      <% unless authenticated? %>
        <div class="flex items-center gap-4">
          <!-- Language Selector -->
          <div class="flex gap-2">
            <% I18n.available_locales.each do |locale| %>
              <%= link_to locale_to_flag(locale), url_for(locale: locale), class: "text-xl #{locale == I18n.locale ? 'opacity-100' : 'opacity-60 hover:opacity-100'}" %>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- Mobile Menu Toggle Button -->
      <% if authenticated? %>
        <button
          data-action="click->menu#toggle"
          class="
            sm:hidden flex-shrink-0 text-white focus:outline-none focus:ring-2
            focus:ring-white rounded p-2
          "
          aria-label="Toggle navigation"
        >
          <svg
            class="h-6 w-6"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"
            />
          </svg>
        </button>
      <% end %>
    </div>

    <!-- Mobile Navigation Menu -->
    <% if authenticated? %>
      <div
        data-menu-target="dropdown"
        class="hidden sm:hidden mt-4 pb-4 border-t border-blue-500"
      >
        <!-- Mobile Search -->
        <div class="mb-4">
          <%= form_with(url: search_articles_path, method: :get, data: { turbo_frame: "articles", controller: "search" }) do |f| %>
            <%= f.text_field :query,
                placeholder: t("search"),
                class: "w-full px-4 py-2 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-300",
                data: { turbo_frame: "articles", search_target: "input" } %>
          <% end %>
        </div>

        <!-- Mobile Menu Items -->
        <div class="space-y-2">
          <% unless request.path == "/feeds/new" %>
            <div>
              <%= link_to t("feeds.new"), new_feed_path, class: "block rounded-lg py-2 px-4 border-2 border-white text-white hover:bg-blue-700 font-medium text-center" %>
            </div>
          <% end %>

          <div>
            <%= link_to t("settings.profile"), user_path(Current.user), class: "block px-4 py-2 text-white hover:bg-blue-700 rounded" %>
          </div>

          <div>
            <%= link_to t("bookmarks"), bookmarks_path, class: "block px-4 py-2 text-white hover:bg-blue-700 rounded" %>
          </div>

          <div>
            <%= link_to t("users.settings.title"), settings_user_path(Current.user), class: "block px-4 py-2 text-white hover:bg-blue-700 rounded" %>
          </div>

          <% if Current.user.is_admin %>
            <div>
              <%= link_to "Admin", "/avo", class: "block px-4 py-2 text-white hover:bg-blue-700 rounded" %>
            </div>
          <% end %>

          <!-- Language Selector for Mobile -->
          <div class="px-4 py-2 border-t border-blue-500 pt-4">
            <p class="text-sm text-blue-100 mb-2">Language</p>

            <div class="flex gap-3">
              <% I18n.available_locales.each do |locale| %>
                <%= link_to locale_to_flag(locale), url_for(locale: locale), class: "text-xl #{locale == I18n.locale ? 'opacity-100' : 'opacity-60'}" %>
              <% end %>
            </div>
          </div>

          <div class="border-t border-blue-500 pt-4 mt-4">
            <%= button_to t("home.sign_out"), session_path, method: :delete, class: "w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded font-medium" %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</nav>
